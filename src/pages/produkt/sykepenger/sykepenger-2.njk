---
tags: ['produkt']
description: 'Sticky navigasjon'
permalink: 'produkt/sykepenger/2/index.html'
variant: '2'
---
{%- extends 'base.njk' -%}

{%- from "macros/button.njk" import button -%}
{%- from "macros/microcard.njk" import microcard -%}
{%- from "macros/tile.njk" import tile -%}

{%- block content -%}
  {% set chapters = collections.all | onlyTags('sykepenger', 'innhold') | sort(false, false, 'data.order') %}

  <main class="grid py-16 grid-cols-center" data-theme="sykepenger" x-data="{ showChapter1: false, showChapter2: false, showChapter3: false, showChapter4: false, showChapter5: false, showToc: false, expandToc: false }">
    <div class="col-main">
      <div class="text-sm tracking-widest uppercase">{{ type | safe }}</div>
      <h1 class="mt-1 font-bold text-4xl/tight text-balance ">{{ title | safe }}</h1>
      <div class="mt-8 text-lg text-pretty max-w-prose">{{ ingress | markdown | safe }}</div>

      {# Audience #}
      {% if audience %}       
      <div class="mt-6 -ml-1">
        <span class="inline-block px-3 py-2 text-sm leading-none rounded-full bg-slate-200 ">
          For {{ audience | lower | safe }}
        </span>
      </div>
      {% endif %}
    </div>

    {# Innholdsfortegnelse #}
    <nav 
      class="mt-8 -mb-8 bg-white"
      x-intersect:enter.margin.-5px.0%.0%.0%="showToc = false"
      x-intersect:leave.margin.-5px.0%.0%.0%="showToc = true"
    >
      <h2 class="pb-2 text-base font-semibold">Innhold på siden</h2>
      <ul class="grid gap-4 py-1">
        {% for chapter in chapters.slice(0, -1) %}
        <li class="flex items-start gap-2">
          <a class="flex gap-1 p-1 -m-1 text-blue-500 group hover:text-blue-700 text-base/snug hover:underline" href="#{{ chapter.data.title | slugify }}">
            {{ '/src/_includes/svg/icons/arrow-right-angle.svg' | svgContents('w-5 h-5') | safe }}
            {{ chapter.data.title }}
          </a>
          {# <span class="flex-1 h-px min-w-4 -translate-y-[0.25em] bg-dotted-x" aria-hidden="true"></span> #}
          {# <p class="pr-4 mt-1.5 text-pretty opacity-85">{{ chapter.data.ingress | safe }}</p> #}
        </li>
        {% endfor %}
      </ul>
    </nav>

    {# Sticky Chapter TOC #}
    <div class="sticky top-0 z-10 isolate" x-show="showToc" aria-hidden="true">
      <div class="absolute inset-x-0 top-0 h-12 pointer-events-none bg-gradient-to-b from-white to-white/0"></div>
      <button class="absolute z-20 left-1/2 top-1 px-3 -translate-x-1/2  mx-auto justify-center whitespace-nowrap pr-3 pl-4 py-1.5 flex gap-1 items-center rounded-full bg-slate-700 text-white hover:bg-slate-500" type="button" x-on:click="expandToc = !expandToc">
        <span>Innhold på siden</span>
        {{ '/src/_includes/svg/icons/chevron-down.svg' | svgContents('w-5 h-5') | safe }}
      </button>
      <div class="absolute inset-x-0 top-0 z-10 px-3 pt-20 pb-4 rounded-b-lg" x-bind:class="expandToc ? 'bg-slate-600 text-white shadow-lg' : 'hidden'">
        <ol class="grid gap-2 toc toc--multi toc--sticky" x-show="expandToc">
          {% for chapter in chapters.slice(0, -1) %}
          <li>
            <a 
              class="flex gap-1 p-1 underline group hover:text-blue-50 text-base/snug hover:no-underline" 
              href="#{{ chapter.data.title | slugify }}" 
              x-on:click="expandToc = false"
            >
              {{ '/src/_includes/svg/icons/arrow-right-angle.svg' | svgContents('w-5 h-5') | safe }}
              {{ chapter.data.title }}
            </a>
          </li>
          {% endfor %}
          <li class="pt-2 mt-1 border-t border-slate-400/25">
            <a 
              class="flex gap-1 p-1 underline group hover:text-blue-50 text-base/snug hover:no-underline" 
              href="{{ page.url }}" 
              x-on:click="expandToc = false"
            >
              {{ '/src/_includes/svg/icons/arrow-up.svg' | svgContents('translate-y-px w-5 h-5') | safe }}
              Til toppen av siden
            </a>
          </li>
        </ol>
      </div>
    </div>

    {# Innhold #}
    {% for chapter in chapters %}
      {% set chapterIndex = loop.index %}
      <section 
        class="grid grid-flow-row-dense mt-24 col-full grid-cols-center" 
        id="{{ chapter.data.title | slugify }}" 
        x-data="{ tocOpen: false }"
        x-intersect:enter.margin.-20%.0px.-60%.0px="showChapter{{ chapterIndex }} = true"
        x-intersect:leave.margin.-20%.0px.-60%.0px="showChapter{{ chapterIndex }} = false"
      >
        <div class="col-main">
          <h2 class="mt-8 mb-3 font-bold text-3xl/tight text-balance ">{{ chapter.data.title }}</h2>
          <p class="mb-6">{{ chapter.data.ingress | safe }}</p>

          {% if chapter.templateContent and chapter.templateContent | tocData | length > 0 %}
            <nav>
              <h3 class="font-semibold">I dette kapittelet</h3>
              <ul class="grid gap-1">
                {% for item in chapter.templateContent | tocData %}
                <li>
                  <a class="flex gap-1 py-1 -mx-1 text-blue-500 group hover:text-blue-700 text-base/snug hover:underline" href="#{{ item.id }}">
                    {{ '/src/_includes/svg/icons/arrow-right-angle.svg' | svgContents('w-5 h-5') | safe }}
                    {{ item.text }}
                  </a>
                </li>
                {% endfor %}
              </ul>
            </nav>
          {% endif %}

          <div class="prose">
            {{ chapter.templateContent | markdown | safe }}
          </div>
        </div>
      </section>
    {% endfor %}

    <div class="pt-2 mt-12 text-sm italic border-t border-slate-200 col-main">{{ published | safe }}</div>
  </main>
{%- endblock -%}


{% block bodyscript %}
  <script>
    const headings = document.querySelectorAll('.prose h3');
    const headingsArr = Array.from(headings);

    const navItems = document.querySelectorAll('.toc--sticky li');

    function activateNavByIndex(index) {
      if (headings[index].classList.contains('active'))
        return;

      const currentActive = document.querySelectorAll('.toc--sticky .active');
      for (let i = currentActive.length - 1; i >= 0; i--) {
        currentActive[i].classList.remove('active');
      }
      navItems[index].classList.add('active');
    };

    const intersectionCallback = (entries, observer) => {
      if (entries[0].intesectionRatio <= 0)
          return;
      
      if (entries[0].intersectionRatio > 0.90) {    
        activateNavByIndex(headingsArr.indexOf(entries[0].target))
      }
    };

    const intersectionOptions = {
      threshold: 1,
      rootMargin: '15% 0px -60% 0px'
    };

    const intersectionObserver = new IntersectionObserver(intersectionCallback, intersectionOptions);

    for (let i = 0; i < headings.length; i++) {
      intersectionObserver.observe(headings[i]);  
    };

  </script>
{% endblock %}