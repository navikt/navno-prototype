{%- set audience = audienceOverride or menu.audience -%}

{%- set menuButtonClasses = "flex flex-col xs:flex-row items-center justify-center pl-2 pr-3 leading-none cursor-pointer font-semibold gap-1 text-blue-600 rounded min-w-16 py-2 text-fluid-16-18 xs:text-fluid-18-20 pointer-fine:hover:bg-blue-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-800 group peer" -%}

<header class="relative z-50 bg-white">
  <div class="z-10 grid grid-cols-article">

    <div class="grid grid-cols-[auto_1fr] sm:grid-cols-[auto_auto_1fr] col-container">

      <div class="flex items-center sm:col-span-2">
        {# Logo #}
        <div class="flex items-center py-5 sm:py-6">
          <a href="/forside/" class="block px-3 py-2.5 -ml-3.5 text-nav-red rounded-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-800">
            {{ '/src/_includes/svg/logo.svg' | svgContents('w-logo h-auto') | safe }}
            <span class="sr-only">NAV</span>
          </a>
        </div>

        {# Separator #}
        <div class="w-px h-8 mx-2 origin-center bg-slate-300"></div>

        {# Audience #}
        <div class="self-center pl-3 leading-tight text-fluid-20-22">
          <button class="cursor-default" x-on:click="menuOpen = !menuOpen, myPageOpen = false, loginOpen = false" type="button">
            {{ activeRole }}
          </button>
        </div>
      </div>

      {# Menu Buttons #}

      <div class="flex self-center py-2 -mr-1 sm:gap-2 justify-self-end">
        <button 
          class="{{ menuButtonClasses }} ml-1 order-2" 
          type="button" 
          x-on:click="menuOpen = !menuOpen, myPageOpen = false, loginOpen = false"
          x-bind:class="menuOpen && 'bg-blue-50'" 
          x-bind:aria-expanded="menuOpen"
        >
          <template x-if="!menuOpen">
            {{ '/src/_includes/svg/icons/menusearch.svg' | svgContents('w-7 h-7  shrink-0 pointer-events-none') | safe }}
          </template>
          <template x-if="menuOpen">
            {{ '/src/_includes/svg/icons/close.svg' | svgContents('w-7 h-7 shrink-0 pointer-events-none') | safe }}
          </template>
          <span class="mt-px">Meny og søk</span>
        </button>
      </div>
    </div>
  </div>


  {%- include "partials/navigation.njk" -%}

  <div class="grid justify-center py-1 bg-blue-50 min-h-8 grid-cols-page">
    <a 
      class="inline-flex items-center gap-1 px-3 py-1 text-blue-600" 
      href="/min-side" 
      x-bind:class="myPageOpen && 'bg-slate-200'" 
      x-show="loggedIn" 
      x-bind:aria-expanded="myPageOpen"
    >
      {{ '/src/_includes/svg/icons/person-circle.svg' | svgContents('w-7 h-7 -ml-0.5 shrink-0 pointer-events-none') | safe }}
      <span class="mt-px sm:hidden">Min side</span>
      <span class="hidden mt-px sm:inline-block">Isac Norland</span>
    </a>
    <button 
      class="inline-flex items-center gap-2 px-3 py-1 text-blue-600 cursor-pointer hover:underline decoration-blue-400 underline-offset-3" 
      type="button" 
      x-show="!loggedIn" 
      x-on:click="loginOpen = !loginOpen, menuOpen = false, myPageOpen = false" 
      x-bind:aria-expanded="loginOpen"
    >
      {{ '/src/_includes/svg/icons/login.svg' | svgContents('w-7 h-7 shrink-0 pointer-events-none') | safe }}
      <span>Logg inn (Krever Bank-ID eller …)</span>
    </button>
  </div>

  {%- include "partials/login.njk" -%}
</header>

{# Overlay #}
<button 
  class="fixed inset-0 z-40 w-full h-full cursor-default bg-gray-400/40 backdrop-blur-xs" 
  type="button"
  x-show="(menuOpen || myPageOpen || loginOpen || floatingTocOpen)" 
  x-on:click="menuOpen = false, myPageOpen = false, loginOpen = false, floatingTocOpen = false" 
  x-on:keyup.escape.window="menuOpen = false, myPageOpen = false,  loginOpen = false"
  x-transition:enter="transition ease-out duration-75"
  x-transition:enter-start="opacity-0"
  x-transition:enter-end="opacity-100"
  x-bind:hidden="overlayOpen"
  hidden></button>
